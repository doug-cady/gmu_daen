---
title: "Human Freedom Index and Suicides Project"
subtitle: "Part 2: Data Exploration with HFI Dataset"
author: "Doug Cady"
date: "November 9, 2021"
output:
    pdf_document:
        toc: true
---

```{r hidden, echo = FALSE}
# html_document:
#         toc: true
#         theme: simplex
#         highlight: tango
#     pdf_document:
#         toc: true
```

R version 4.1.1 "Kick Things"

```{r packs, results = 'hide', message = FALSE}
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(GGally)
```


## Load dataset into R

```{r data, results = 'hide', message = FALSE}
hfi <- read_csv("../data/hfi_cc_2018.csv")
```


## Explore HFI dataset
### Questions to answer:
* Are the freedom score, number of suicides per 100k, and gdp per capita related?
    + Find correlations, make 3 scatter pair plots
* Does population size impact freedom?
* Does female freedom scores relate to female suicide rates?
* What are important factors that contribute to human freedom?
    + Linear regression model


### Hypotheses:
1. Countries with high female freedom scores will have less than average female suicide rates

    Ho: mean suicide rates lo female freedom >= average female suicide rate

    Ha: mean suicide rates hi female freedom < average female suicide rate

    + `pf_ss_women_fgm` - Female genital mutilation
    + `pf_ss_women_inheritance` - Equal inheritance rights for widows and daughters
    + `pf_movement_women` - Freedom of movement for women
    + `pf_identity_sex_female` - Female to female relationships
    + `pf_identity_divorce` - Divorce
    + Perhaps educational opportunity or abortion access should be included here as well?
2. Countries with smaller populations will have more freedom

    Ho: mean freedom small population <= mean freedom large population

    Ha: mean freedom small population > mean freedom large population

    + `hf_score` - Overall Human Freedom Index score
    + `population` - (suicides dataset) country population


### Column Descriptions
There are many, many columns in this dataset, so let us focus on a few columns

* 1 time-series variable
    + `year`
* 3 categorical variables
    + `country`
    + `ISO_code` (country abbreviation)
    + `region`
* 119 numeric (narrowed down to only a handful)
    + Freedom indicators and their aggregate category scores, like
        - Female genital mutilation and inheritance rights (widows, daughters) make up 3 columns
        and are aggregated into one category score - Female security and safety


```{r}
categ_cols <- c(
    "year",
    "country",
    "region"
)

focus_cols <- c(
    "pf_ss_women_fgm",
    "pf_ss_women_inheritance",
    "pf_movement_women",
    "pf_identity_sex_female",
    "pf_identity_divorce",
    "pf_score",
    "ef_score",
    "hf_score"
)


# Look at focus subset of columns and update categoricals to factor type
hfi_focus <- rename(hfi, country = countries) %>%
    mutate(country = factor(country),
           region = factor(region))
hfi_focus <- hfi_focus[, str_c(c(categ_cols, focus_cols))]
write_csv(hfi_focus, "../data/clean_hfi_2018.csv")

print(str(hfi_focus))
```

### Head / Tail of Data
Nothing out of the ordinary here. It seems like we read in the whole file and do not need to skip
any header or footer miscellaneous data.
```{r}
print(head(hfi_focus))
print(tail(hfi_focus))
```


### Distribution of Scores - Personal, Economic, Overall Human Freedom
```{r, message = FALSE, warning = FALSE}
score_cols <- c("pf_score", "ef_score", "hf_score")
scores <- hfi_focus %>%
    pivot_longer(cols = score_cols, names_to = "freedom", values_to = "score")
scores <- scores[, str_c(c(categ_cols, "freedom", "score"))]

scores$freedom <- recode_factor(scores$freedom, "pf_score" = "Personal",
                                                "ef_score" = "Economic",
                                                "hf_score" = "Overall")

# Freedom distribution
ggplot(scores) +
    geom_density(aes(x = score, color = freedom, fill = freedom), alpha = 0.3) +
    labs(x = '', y = 'Density', title = 'Score Distribution Comparison', color = '', fill = '') +
    scale_x_continuous(limits = c(2, 10))
```

##### Personal freedom scores are more spread out than economic or overall freedom scores. Very few countries have scores below 4. The majority of economic scores fall between 6 and 8, lower than many countries' personal freedom scores.


### Women Freedom
```{r}

women_freedom_cols <- c(
    "pf_ss_women_fgm",
    "pf_ss_women_inheritance",
    "pf_movement_women",
    "pf_identity_sex_female",
    "pf_identity_divorce")

women_freedom_init <- hfi_focus[, str_c(c(categ_cols, women_freedom_cols))]
summary(women_freedom_init)
```

#### Missing values
The 5 women freedom variables have at least 5% missing values with Divorce having almost 60%:

* `pf_ss_women_fgm` - Female genital mutilation - 11.8% missing
* `pf_ss_women_inheritance` - Female inheritance - 8.2%
* `pf_movement_women` - Women movement - 9.7%
* `pf_identity_sex_female` - Female to female relationships - 5.5%
* `pf_identity_divorce` - Divorce - 59.9%

```{r, message = FALSE}
sapply(women_freedom_init,
       function(x) paste0(round(sum(is.na(x)) / nrow(women_freedom_init) * 100, 1), "%"))

# What to do about Divorce missing values? Impute? Interpolate? Remove?
# Instead, we can average the 5 women freedom columns together and then remove the columns
# with NAs - equal to the minimum NA% from the individual columns (5.5%)
women_freedom_init$avg_women_score <- rowMeans(select(women_freedom_init, women_freedom_cols),
                                               na.rm = TRUE)

women_freedom <- women_freedom_init[!is.na(women_freedom_init$avg_women_score),
                                    c("year", "country", "region", "avg_women_score")]

ggplot(women_freedom) + geom_histogram(aes(x = avg_women_score))
```
